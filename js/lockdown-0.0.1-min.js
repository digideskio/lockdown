/*!
 * Lockdown.js
 * Obfuscates code snippets by writing them to the canvas
 * http://draeton.github.com/lockdown
 *
 * Copyright 2011, Matthew Cobbs
 * Licensed under the MIT license.
 */
(function(window,$){var document=window.document;var c={fontsize:12,lineheight:24,font:"12px Courier",baseline:"top",yoffset:(24-12)/2-2,linecolor:"blue",codecolor:"black",rowcolor:"LightCyan",top:10,left:15,indent:8,width:600,check:new RegExp("^--remove this line--")};function Lockdown(options){this.configure(options);return this;}Lockdown.prototype={context:null,configure:function(options){this.settings=$.extend({},c,options);},lock:function($elements){var self=this;if($elements){$elements.each(function(){self.replaceCodeBlock(this,this.innerText,this.className);});}},getCode:function(innerText,className){var s=this.settings;if(/base64/.test(className)){innerText=decodeURIComponent(innerText);}var code=$.trim(innerText).split("\n");return $(code).filter(function(i,line){return !s.check.test(line);});},getCanvas:function(code){var s=this.settings;var canvas=document.createElement("canvas");canvas.width=s.width;canvas.height=code.length*s.lineheight+s.top*2;canvas.style.width=canvas.width+"px";canvas.style.height=canvas.height+"px";if(typeof FlashCanvas!=="undefined"){FlashCanvas.initElement(canvas);}return canvas;},writeText:function(text,x,y,color,align){var s=this.settings;this.context.font=s.font;this.context.textAlign=align||"left";this.context.textBaseline=s.baseline;this.context.fillStyle=color;this.context.fillText(text,x,y);},writeTextRight:function(text,x,y,color){this.writeText(text,x,y,color,"right");},writeLine:function(i,line){var s=this.settings;var linex=s.left+s.indent-c.indent;var liney=i*s.lineheight+s.top+s.yoffset;var codex=s.left+s.indent;var codey=i*s.lineheight+s.top+s.yoffset;if(i%2){this.context.fillStyle=s.rowcolor;this.context.fillRect(0,i*s.lineheight+s.top,s.width,s.lineheight);}this.writeTextRight(i+1,linex,liney,s.linecolor);this.writeText(line,codex,codey,s.codecolor);},replaceCodeBlock:function(element,innerText,className){var s=this.settings;var code=this.getCode(innerText,className);s.indent=c.indent*(code.length+"").length;var canvas=this.getCanvas(code);$(element).replaceWith(canvas);$(canvas).addClass("lockdown");this.context=canvas.getContext("2d");$(code).each($.proxy(this.writeLine,this));}};window.Lockdown=new Lockdown;})(window,jQuery);